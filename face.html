<!DOCTYPE html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicar QSOs en Facebook</title>
</head>
<body>
    <h1>Últimos QSOs de EA2PW</h1>

    <div id="hrdlog">Cargando QSOs...</div>

    <!-- Cargar el script de HRDLOG.net -->
    <script type="text/javascript" language="javascript" src="https://www.hrdlog.net/hrdlog.js"></script>

    <script type="text/javascript">
        window.onload = function() {
            var ohrdlog = new HrdLog('EA2PW');
            ohrdlog.LoadLastQso(10);

            ohrdlog.OnLastQsoLoaded = function(qsoData) {
                var resultadoDiv = document.getElementById('hrdlog');
                var message = '';

                if (qsoData.length > 0) {
                    var htmlContent = '<ul>';
                    qsoData.forEach(function(qso) {
                        htmlContent += `<li>Fecha: ${qso.date} - Llamada: ${qso.callsign} - Banda: ${qso.band} - Modo: ${qso.mode}</li>`;
                        message += `QSO: ${qso.date} - Llamada: ${qso.callsign} - Banda: ${qso.band} - Modo: ${qso.mode}\n`;
                    });
                    htmlContent += '</ul>';
                    resultadoDiv.innerHTML = htmlContent;
                } else {
                    resultadoDiv.innerHTML = 'No se encontraron QSOs recientes.';
                }

                // Publicar en Facebook
                publicarEnFacebook(message);
            };
        };

        // Función para publicar en Facebook usando Graph API
        function publicarEnFacebook(message) {
            // Asegúrate de tener un token de acceso para la página
            var accessToken = 'EAALrDqXE5QMBO4AZC6aTxuijhDB3d8NiI0mQ8nbJiqRZB8JZBRVIO5ZB8it8P39rCsPQ4gPBAkhxVfLrZCoQeZBQnM4yUK8nQspjGTfHpWGOUgLAJxtOmJM8suaXcJRsB5YG66keWepKIzfHVlFCC8B2ltssP5oK27yWQKPKfQkuM9tisNG2TZChjjZBfvDTEacoyrbL56ke4k0ZAHD52oHThNjeh85MJivZCti2b4ofZApGA8zZATdn6zNpBGOuJhqFAAZDZD';  // Reemplaza con tu token de acceso
            var pageId = '821398096635139';  // Reemplaza con tu ID de página

            // URL de la API de Facebook
            var url = `https://graph.facebook.com/${pageId}/feed`;

            // Datos a enviar a la API de Facebook
            var data = {
                message: message,
                access_token: accessToken
            };

            // Realizar la solicitud POST usando fetch (requiere soporte de ES6+)
            fetch(url, {
                method: 'POST',
                body: new URLSearchParams(data),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    console.log('Publicado en Facebook con éxito', data);
                } else {
                    console.error('Error al publicar en Facebook', data);
                }
            })
            .catch(error => {
                console.error('Error al hacer la solicitud', error);
            });
        }
    </script>
</body>
</html>

